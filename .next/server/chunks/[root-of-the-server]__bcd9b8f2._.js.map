{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///Users/camilamota/Developer/app-astroglix/src/lib/stripe.ts"],"sourcesContent":["// Configura√ß√£o da Kirvano\nexport const KIRVANO_CONFIG = {\n  checkoutUrl: 'https://pay.kirvano.com/d7908b12-5e92-44b7-bffc-9e3433b7ff9d',\n  currency: 'BRL',\n  country: 'BR',\n  productName: 'Relat√≥rio M√≠stico Completo',\n  productDescription: 'Numerologia, Astrologia, Zod√≠aco Chin√™s e Astrocartografia',\n  price: 80.00\n}\n\n// Fun√ß√£o para criar URL de pagamento personalizada com dados do cliente\nexport const createKirvanoPaymentUrl = (\n  customerData: { name: string; email: string; cpf?: string }, \n  baseUrl?: string,\n  successUrl?: string,\n  cancelUrl?: string\n) => {\n  const checkoutUrl = baseUrl || KIRVANO_CONFIG.checkoutUrl\n  const params = new URLSearchParams({\n    customer_name: customerData.name,\n    customer_email: customerData.email,\n    ...(customerData.cpf && { customer_cpf: customerData.cpf }),\n    ...(successUrl && { success_url: successUrl }),\n    ...(cancelUrl && { cancel_url: cancelUrl })\n  })\n  \n  return `${checkoutUrl}?${params.toString()}`\n}"],"names":[],"mappings":"AAAA,0BAA0B;;;;;AACnB,MAAM,iBAAiB;IAC5B,aAAa;IACb,UAAU;IACV,SAAS;IACT,aAAa;IACb,oBAAoB;IACpB,OAAO;AACT;AAGO,MAAM,0BAA0B,CACrC,cACA,SACA,YACA;IAEA,MAAM,cAAc,WAAW,eAAe,WAAW;IACzD,MAAM,SAAS,IAAI,gBAAgB;QACjC,eAAe,aAAa,IAAI;QAChC,gBAAgB,aAAa,KAAK;QAClC,GAAI,aAAa,GAAG,IAAI;YAAE,cAAc,aAAa,GAAG;QAAC,CAAC;QAC1D,GAAI,cAAc;YAAE,aAAa;QAAW,CAAC;QAC7C,GAAI,aAAa;YAAE,YAAY;QAAU,CAAC;IAC5C;IAEA,OAAO,GAAG,YAAY,CAAC,EAAE,OAAO,QAAQ,IAAI;AAC9C","debugId":null}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"sources":["file:///Users/camilamota/Developer/app-astroglix/src/app/api/create-kirvano-payment/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createKirvanoPaymentUrl, KIRVANO_CONFIG } from '@/lib/stripe'\nimport { writeFile, readFile } from 'fs/promises'\nimport { join } from 'path'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { planType, amount, currency, customerData, personalData } = await request.json()\n\n    console.log('üî• Criando pagamento Kirvano:', { planType, amount, currency })\n\n    // Valida√ß√£o dos dados obrigat√≥rios\n    if (!customerData.name || !customerData.email) {\n      return NextResponse.json({\n        success: false,\n        error: 'Nome e email s√£o obrigat√≥rios para o pagamento.'\n      }, { status: 400 })\n    }\n\n    // Valida√ß√£o do valor\n    if (amount !== KIRVANO_CONFIG.price) {\n      return NextResponse.json({\n        success: false,\n        error: 'Valor do produto n√£o corresponde ao esperado.'\n      }, { status: 400 })\n    }\n\n    // Gerar ID √∫nico para a sess√£o de pagamento\n    const paymentId = `kirvano_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n    \n    // URLs de callback para sucesso e cancelamento\n    const successUrl = `${request.nextUrl.origin}/payment/redirect`\n    const cancelUrl = `${request.nextUrl.origin}/success?status=canceled&canceled=true`\n\n    // Salvar dados do usu√°rio temporariamente para gerar o relat√≥rio ap√≥s pagamento\n    if (personalData) {\n      try {\n        const dataToSave = {\n          paymentId,\n          customerData,\n          personalData,\n          timestamp: new Date().toISOString(),\n          planType,\n          amount\n        }\n        \n        // Criar diret√≥rio de dados tempor√°rios se n√£o existir\n        const dataDir = join(process.cwd(), 'tmp')\n        const filePath = join(dataDir, `${paymentId}.json`)\n        \n        // Salvar dados em arquivo tempor√°rio\n        await writeFile(filePath, JSON.stringify(dataToSave, null, 2))\n        console.log('‚úÖ Dados salvos temporariamente:', paymentId)\n      } catch (saveError) {\n        console.error('‚ö†Ô∏è Erro ao salvar dados tempor√°rios:', saveError)\n        // Continue mesmo se n√£o conseguir salvar\n      }\n    }\n\n    // Cria a URL de pagamento personalizada com URLs de retorno\n    const paymentUrl = createKirvanoPaymentUrl({\n      name: customerData.name,\n      email: customerData.email,\n      cpf: customerData.cpf // Opcional\n    }, undefined, successUrl, cancelUrl)\n\n    console.log('‚úÖ URL Kirvano criada:', paymentUrl)\n\n    return NextResponse.json({\n      success: true,\n      paymentUrl,\n      paymentId,\n      paymentMethod: 'kirvano',\n      data: {\n        url: paymentUrl,\n        paymentId,\n        customerData: {\n          name: customerData.name,\n          email: customerData.email\n        },\n        product: {\n          name: KIRVANO_CONFIG.productName,\n          description: KIRVANO_CONFIG.productDescription,\n          price: KIRVANO_CONFIG.price,\n          currency: KIRVANO_CONFIG.currency\n        }\n      }\n    })\n\n  } catch (error) {\n    console.error('üí• Erro ao criar pagamento Kirvano:', error)\n    \n    let errorMessage = 'Erro interno do servidor'\n    \n    if (error instanceof Error) {\n      errorMessage = error.message\n    }\n\n    return NextResponse.json({\n      success: false,\n      error: errorMessage\n    }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE,YAAY,EAAE,YAAY,EAAE,GAAG,MAAM,QAAQ,IAAI;QAErF,QAAQ,GAAG,CAAC,iCAAiC;YAAE;YAAU;YAAQ;QAAS;QAE1E,mCAAmC;QACnC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,KAAK,EAAE;YAC7C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;YACT,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,qBAAqB;QACrB,IAAI,WAAW,sHAAA,CAAA,iBAAc,CAAC,KAAK,EAAE;YACnC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;YACT,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,4CAA4C;QAC5C,MAAM,YAAY,CAAC,QAAQ,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;QAEpF,+CAA+C;QAC/C,MAAM,aAAa,GAAG,QAAQ,OAAO,CAAC,MAAM,CAAC,iBAAiB,CAAC;QAC/D,MAAM,YAAY,GAAG,QAAQ,OAAO,CAAC,MAAM,CAAC,sCAAsC,CAAC;QAEnF,gFAAgF;QAChF,IAAI,cAAc;YAChB,IAAI;gBACF,MAAM,aAAa;oBACjB;oBACA;oBACA;oBACA,WAAW,IAAI,OAAO,WAAW;oBACjC;oBACA;gBACF;gBAEA,sDAAsD;gBACtD,MAAM,UAAU,CAAA,GAAA,iGAAA,CAAA,OAAI,AAAD,EAAE,QAAQ,GAAG,IAAI;gBACpC,MAAM,WAAW,CAAA,GAAA,iGAAA,CAAA,OAAI,AAAD,EAAE,SAAS,GAAG,UAAU,KAAK,CAAC;gBAElD,qCAAqC;gBACrC,MAAM,CAAA,GAAA,qHAAA,CAAA,YAAS,AAAD,EAAE,UAAU,KAAK,SAAS,CAAC,YAAY,MAAM;gBAC3D,QAAQ,GAAG,CAAC,mCAAmC;YACjD,EAAE,OAAO,WAAW;gBAClB,QAAQ,KAAK,CAAC,wCAAwC;YACtD,yCAAyC;YAC3C;QACF;QAEA,4DAA4D;QAC5D,MAAM,aAAa,CAAA,GAAA,sHAAA,CAAA,0BAAuB,AAAD,EAAE;YACzC,MAAM,aAAa,IAAI;YACvB,OAAO,aAAa,KAAK;YACzB,KAAK,aAAa,GAAG,CAAC,WAAW;QACnC,GAAG,WAAW,YAAY;QAE1B,QAAQ,GAAG,CAAC,yBAAyB;QAErC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA;YACA,eAAe;YACf,MAAM;gBACJ,KAAK;gBACL;gBACA,cAAc;oBACZ,MAAM,aAAa,IAAI;oBACvB,OAAO,aAAa,KAAK;gBAC3B;gBACA,SAAS;oBACP,MAAM,sHAAA,CAAA,iBAAc,CAAC,WAAW;oBAChC,aAAa,sHAAA,CAAA,iBAAc,CAAC,kBAAkB;oBAC9C,OAAO,sHAAA,CAAA,iBAAc,CAAC,KAAK;oBAC3B,UAAU,sHAAA,CAAA,iBAAc,CAAC,QAAQ;gBACnC;YACF;QACF;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uCAAuC;QAErD,IAAI,eAAe;QAEnB,IAAI,iBAAiB,OAAO;YAC1B,eAAe,MAAM,OAAO;QAC9B;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO;QACT,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF","debugId":null}}]
}